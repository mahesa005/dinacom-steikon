generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String   @id @default(cuid())
  username       String   @unique
  password       String
  namaPuskesmas  String
  provinsi       String
  kota           String
  kecamatan      String
  kelurahan      String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  bayiRegistered Bayi[]

  @@map("users")
}

model Bayi {
  id              String            @id @default(cuid())
  nomorPasien     String            @unique
  nik             String?           @unique
  nama            String
  tanggalLahir    DateTime
  tempatLahir     String
  jenisKelamin    String
  beratLahir      Float
  panjangLahir    Float
  namaIbu         String
  namaAyah        String
  nomorHpOrangTua String
  alamat          String
  golonganDarah   String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  createdById     String
  createdBy       User              @relation(fields: [createdById], references: [id])
  hasilAnalisis   HasilAnalisisAI[]
  historyKontrol  HistoryKontrol[]
  jadwalPemeriksaan JadwalPemeriksaan[]

  @@map("bayi")
}

model HistoryKontrol {
  id              String   @id @default(cuid())
  bayiId          String
  tanggalKontrol  DateTime
  umurBulan       Int
  beratBadan      Float
  tinggiBadan     Float
  statusGizi      String?
  statusStunting  String?
  catatanTambahan String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  bayi            Bayi     @relation(fields: [bayiId], references: [id], onDelete: Cascade)

  @@index([bayiId])
  @@index([tanggalKontrol])
  @@map("history_kontrol")
}

model HasilAnalisisAI {
  id                  String   @id @default(cuid())
  bayiId              String
  jenisAnalisis       String
  hasilPrediksi       String
  tingkatKepercayaan  Float?
  dataInput           String
  rekomendasiTindakan String?
  catatanAI           String?
  createdAt           DateTime @default(now())
  bayi                Bayi     @relation(fields: [bayiId], references: [id], onDelete: Cascade)

  @@index([bayiId])
  @@index([createdAt])
  @@map("hasil_analisis_ai")
}

enum JadwalStatus {
  SCHEDULED // Jadwal aktif, bayi belum datang
  COMPLETED // Bayi sudah datang (sinkron dengan HistoryKontrol)
  MISSED    // Melewati range tanggal tapi belum datang
}

model JadwalPemeriksaan {
  id              String       @id @default(cuid())
  bayiId          String
  targetUmurBulan Int          // Milestone ke-berapa (0, 1, 2, dst)
  rentangAwal     DateTime     // Awal bayi boleh datang
  rentangAkhir    DateTime     // Batas akhir bayi harus datang
  status          JadwalStatus @default(SCHEDULED)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  bayi            Bayi         @relation(fields: [bayiId], references: [id], onDelete: Cascade)

  @@index([bayiId])
  @@index([status])
  @@map("jadwal_pemeriksaan")
}
